<!DOCTYPE html>
<html>
<head>
  <title>HT Messenger - Inscription</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="container">
  <h2>Créer un compte</h2>

  <input id="name" placeholder="Nom">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Mot de passe">

  <button id="btn">S'inscrire</button>

  <p style="text-align:center">
    Déjà un compte ?
    <a href="login.html">Se connecter</a>
  </p>
</div>

<script type="module">
  import { auth, db } from "./js/firebase.js";
  import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { set, ref, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  btn.onclick = async () => {
    if(!name.value || !email.value || !password.value) return alert("Tous les champs sont requis");

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email.value, password.value);
      const user = userCredential.user;

      await set(ref(db, `users/${user.uid}`), {
        displayName: name.value,
        email: email.value,
        online: true,
        createdAt: serverTimestamp()
      });

      // Redirection après inscription
      location.href = "index.html";

    } catch(err) {
      alert(err.message);
    }
  }
</script>

</body>
</html>
