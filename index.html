<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>HT Messenger</title>
    <link rel="stylesheet" href="css/style.css">
    <script type="module" src="js/firebase-init.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/conversations.js"></script>
</head>
<body>
    <div class="container">
        <h1>HT Messenger</h1>
        <div id="conversation-list" class="conversation-list"></div>
    </div>

    <script type="module">
        import { getUserConversations } from './js/conversations.js';
        import { getUser } from './js/users.js';

        const currentUserId = "USER_UID"; // Remplacer par l'UID connecté

        async function renderConversations() {
            const convs = await getUserConversations(currentUserId);
            const listEl = document.getElementById('conversation-list');
            listEl.innerHTML = "";

            for (let conv of convs) {
                let name = conv.type === "private" ? "User" : conv.name;
                // Optionnel: récupérer le nom réel
                if(conv.type === "private") {
                    const otherId = conv.participants.find(uid => uid !== currentUserId);
                    const user = await getUser(otherId);
                    if(user) name = user.displayName;
                }

                const unread = conv.unread[currentUserId] || 0;

                const div = document.createElement("div");
                div.className = "conversation-item";
                div.innerHTML = `
                    <span class="conv-name">${name}</span>
                    <span class="conv-last">${conv.lastMessage || ""}</span>
                    ${unread>0 ? `<span class="badge">${unread}</span>` : ""}
                `;
                div.onclick = () => { window.location.href = `chat.html?convId=${conv.id}` };
                listEl.appendChild(div);
            }
        }

        renderConversations();
    </script>
</body>
</html>
